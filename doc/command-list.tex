\chapter{Tao Line Mode Commands}
\label{c:command}

\tao has two \vn{modes} for entering commands. In \vn{Line Mode},
described in this chapter, \tao waits until the \vn{return} key is
depressed to execute a command. That is, a command consists of a
single line of input. Conversely, \vn{Single Mode}, which is described
in Chapter~\sref{c:single}, interprets each keystroke as a
command. Single Mode is useful for quickly varying parameters to see
how they affect a lattice but the number of commands in Single Mode is
limited. To put \tao into \vn{single mode} use the \vn{single-mode}
command (\sref{s:sing}).

\index{commands!Command List} 
Commands are case sensitive. The list of commands is shown in
Table~\ref{t:commands}. Multiple commands may be entered on one line
using the semicolon ``;'' character as a separator.  [However, a
semicolon used as as part of an \vn{alias} (\sref{s:alias}) definition
is part of that definition.]
An exclamation mark ``\vn{!}'' denotes the beginning of
a comment and the exclamation mark and everything after it to the end
of the line is ignored.  Example:
\begin{example}
  view 2; show global  ! Two commands and a comment
\end{example}

%% command_table -----------------------------------------------------

\begin{table}[h]
\centering {\tt
\begin{tabular}{|l|l||l|l|} \hline
  {\it Command} & {\it Section}  & {\it Command} & {\it Section}    \\ \hline
  alias      & \sref{s:alias}    & quit          & \sref{s:quit}     \\ \hline
  call       & \sref{s:call}     & read          & \sref{s:read}     \\ \hline
  change     & \sref{s:change}   & restore       & \sref{s:restore}  \\ \hline 
  clip       & \sref{s:clip}     & reinitialize  & \sref{s:reinit}   \\ \hline 
  continue   & \sref{s:continue} & run_optimizer & \sref{s:run}      \\ \hline 
  derivative & \sref{s:deriv}    & scale         & \sref{s:scale}    \\ \hline 
  end-file   & \sref{s:end.file} & set           & \sref{s:set}      \\ \hline  
  exit       & \sref{s:exit}     & show          & \sref{s:show}     \\ \hline 
  flatten    & \sref{s:flatten}  & single-mode   & \sref{s:sing}     \\ \hline 
  help       & \sref{s:help}     & spawn         & \sref{s:spawn}    \\ \hline 
  history    & \sref{s:history}  & use           & \sref{s:use}      \\ \hline 
  misalign   & \sref{s:misalign} & veto          & \sref{s:veto}     \\ \hline 
  output     & \sref{s:output}   & view          & \sref{s:view}     \\ \hline 
  pause      & \sref{s:pause}    & wave          & \sref{s:wave}     \\ \hline
  place      & \sref{s:place}    & x-axis        & \sref{s:x.axis}   \\ \hline 
  plot       & \sref{s:plot}     & x-scale       & \sref{s:x.scale}  \\ \hline 
             &                   & xy-scale      & \sref{s:xy.scale} \\ \hline
\end{tabular}}
\caption{Table of \tao commands.}
\label{t:commands}
\end{table}

%% Marker: "help" will not display anything after this  -----------

\vfil
\break

%% alias --------------------------------------------------------------
\section{alias}\index{commands!alias}
\label{s:alias}

The \vn{alias} command defines command shortcuts. Format:
\begin{example}
  alias \{<alias_name> <string>\}
\end{example}

\vskip 0.2in

\vn{Alias} is like Unix aliases. Using the \vn{alias} command without
any arguments results in a printout of the aliases that have been
defined. When using an alias up to 9 arguments may be substituted in
the \vn{<string>}. The i\Th argument is substituted in place of the
sub-string ``[[i]]''.  arguments that do not have a corresponding
``[[i]]'' are placed at the end of \vn{<string>}.

Aliases can be set up for multiple commands using semicolons.

Examples:
\begin{example}
    alias xyzzy plot [[1]] model  ! Define xyzzy
    alias                         ! Show all aliases
    xyzzy top                     ! Use an alias
    plot top model                ! Equivalent to "xyzzy top"
    xyzzy top abc                 ! Equivalent to "plot top model abc"
    alias foo  show uni; show top ! "foo" equivalent to "show uni; show top"
\end{example}
In the above example ``xyzzy'' is the alias for the string ``plot [[1]]
model''.  When the command xyzzy is used ``top'' is substituted
for ``[[1]]'' in the string.

%% call --------------------------------------------------------------
\section{call}\index{commands!call}
\label{s:call}

The \vn{call} command opens a command file (\sref{s:command.files}) and
executes the commands in it. 
Format:
\begin{example}
  call <filename> \{<arg_list>\}  \Strut
\end{example}

\vskip 0.2in 
\tao first looks in the current directory for the file. If not
found \tao will look in the directory pointed to by the
\vn{TAO_COMMAND_DIR} directory.  Up to 9 arguments may be passed to
the command file. The i\Th argument is substituted in place of the
string ``[[i]]'' in the file. Nesting of command files (command files
calling other command files) is allowed. There is no limit to the
number of nested files.

Examples:
\begin{example}
    call my_cmd_file abc def 
\end{example}
In the above example the argument ``abc'' is substituted for any
``[[1]]'' appearing the file and ``def'' is substituted for any
``[[2]]''.
\Newline

%% change --------------------------------------------------------------
\section{change}\index{commands!change}
\label{s:change}

The \vn{change} command changes element attribute values or variable
values in the \vn{model} lattice. Format:
\begin{example}
  change element <element_list> <attribute> <number>
  change \{-silent\} variable <name> <locations> <number>
  change  \{n@\}beam_start <coordinate> <number>
\end{example}

\vskip 0.2in 
Generally \vn{<number>} is added to the existing value of the
attribute or variable. That is:
\begin{example}
  final_model_value = initial_model_value + <number>
\end{example}
If "@" is prepended to \vn{<number>} then just the value of
\vn{<number>} is used to set the value
\begin{example}
  final_model_value = <number>
\end{example}
If "d" is prepended to \vn{<number>} then the final value will be the
\vn{design} value plus \vn{<number>}:
\begin{example}
  final_model_value = design_value + <number>
\end{example}
If "\%" is prepended to \vn{<number>} then the final value will be
\begin{example}
  final_model_value = initial_model_value * (1 + <number> / 100)
\end{example}

Element list format (\sref{s:ele.list.format}), without any embedded
blanks, is used for the \vn{<element_list>} argument.

For \vn{change beam_start}, The optional \vn{n@}
universe specification (\sref{s:universe}) may be used to specify the
universe or universes to apply the change command to.

For linear lattices, \vn{change beam_start <coordinate> <number>} 
can be used to vary the starting coordinates where \vn{<coordinate>} is one of: 
\begin{example}
  (x, px, y, py, z, pz)
\end{example}
For circular lattices only the \vn{pz} component is applicable. 
Also for linear lattices, \vn{change element beginning <twiss>} can be used to
vary the starting Twiss parameters where \vn{<twiss>} is one of:  
\begin{example}
  beta_a, beta_b, alpha_a, alpha_b 
  eta_a, eta_b,etap_a, etap_b    
\end{example}

The \vn{-silent} switch, if present, suppresses the printing of what
variables are changed.

Note: \vn{change element} is used for changing real (as opposed to
integer or logical) attributes of an element. To change integer or
logical values, use the \vn{set element} command instead. The \vn{set}
command can also be used to, say, set datum values, etc.

Examples:
\begin{example}
  change ele 3@124 x_offset 0.1     ! Offset element #124 in universe 3 by 0.1
  change ele 1,3:5 x_offset 0.1     ! Offset elements 1, 3, 4, and 5 by 0.1
  change ele q* k1 d 1.2e-2         ! Set the k1 strength of all elements starting with
                                    !   the letter "q" relative to the design
  change ele quadrupole k1 d 1.2e-2 ! Set the k1 strength of all quadrupole elements.
  change var steering[34:36] @1e-3  ! set the steering strength #34-36 to 0.001
  change var steering[*] \%10        ! vary all steering strengths by 10\%
  change 2@beam_start x @0.001      ! set beginning x position in universe 2 to 1 mm.
\end{example}


%% clip --------------------------------------------------------------
\section{clip}\index{commands!clip}
\label{s:clip}

The \vn{clip} command vetoes data points for plotting and
optimizing. That is, the \vn{good_user} logical of the datums
associated with the out-of-bound plotted points are set to False.
Format:
\begin{example}
  clip \{-gang\} \{<where> \{<limit1> \{<limit2>\}\}\}
\end{example}

\vskip 0.2in 

Which graphs are clipped is determined by the \vn{<where>} switch. If
\vn{<where>} is not present, all graphs are clipped. If \vn{where} is a
plot name, then all the graphs of that plot are clipped. If \vn{where}
is the name of a \vn{d2_data} (for example, \vn{orbit}) or a
\vn{d1_data} (for example, \vn{orbit.x}) structure, then those graphs
that display this data are clipped.

The points that are clipped those points whose $y$ values are outside
a certain range defined by \vn{<limit1>} and \vn{<limit2>}. If neither
\vn{<limit1>} nor \vn{<limit2>} are present, the clip range is taken
to be outside the graph minimum and maximum $y$--axis values. If only
\vn{<limit1>} is present then the clip range is outside the region
from -\vn{<limit1>} to +\vn{<limit1>}. If both are present than the
range is from \vn{<limit1>} to \vn{<limit2>}.

The \vn{-gang} switch is apply a clip to corresponding data in a \vn{d2_data}
structure. For example
\begin{example}
  clip -g orbit.x   ! Clips both orbit.x and orbit.y 
\end{example}
Here the \vn{orbit.x} data is clipped and the corresponding data in
\vn{orbit.y} is also vetoed. For example, if datum number 23 in
\vn{orbit.x} is clipped, datum number 23 in \vn{orbit.y} will be
vetoed.

Examples:
\begin{example}
  clip top.x -3  7  ! Clip the curves in the x graph in the top region
  clip bottom       ! Clip the graphs in the bottom region
  clip -g orbit.x   ! Clip the 
\end{example}

%% continue --------------------------------------------------------------
\section{continue}\index{commands!continue}
\label{s:continue}

The \vn{continue} command is used to continue reading of a suspended
command file (\sref{s:command.files}) after a \vn{pause} command
(\vn{s:pause}). Format:
\begin{example}
  continue
\end{example}

%% end-file --------------------------------------------------------------
\section{end-file} \label{s:end.file}
\index{commands!end-file}

The \vn{end-file} command is used in command files
(\sref{s:command.files}) to signal the end of the file. Everything
after an \vn{end-file} command is ignored. An \vn{end-file} command
entered at the command line will simply generate an error message.
Format:
\begin{example}
  end-file
\end{example}

%% exit --------------------------------------------------------------
\section{exit}\index{commands!exit}
\label{s:exit}

The \vn{exit} command exits the program. Same as \vn{Quit}.  Format:
\begin{example}
  exit
\end{example}

%% derivative --------------------------------------------------------------
\section{derivative}\index{commands!derivative}
\label{s:deriv}

The \vn{derivative} command calculates the \vn{dModel_Data/dVar} derivative
matrix needed for the \vn{lm} optimizer.
Format:
\begin{example}
  derivative
\end{example}

%% flatten --------------------------------------------------------------
\section{flatten}\index{commands!flatten}
\label{s:flatten}

The \vn{Flatten} command runs the optimizer to minimize the merit
function. This is the same as the \vn{run_optimizer} command. 
See the \vn{run_optimizer} command for more details.  Format:
\begin{example}
  flatten \{<optimizer>\}
\end{example}

\vskip 0.2in

%% help --------------------------------------------------------------
\section{help}\index{commands!help}
\label{s:help}

The \vn{help} command gives help on \tao commands. Format:
\begin{example}
  help \{<command> \{<subcommand>\}\}
\end{example}

\vskip 0.2in

The \vn{help} command without any arguments gives a list of all commands.
Some commands, like \vn{show}, are so large that help on these commands
is divided up by their subcommand.

Examples:
\begin{example}
  help            ! Gives list of commands.
  help run        ! Gives help on the run_optimizer command.
  help show       ! Help on the show command.
  help show alias ! Help on the show alias command.
\end{example}

Note: The \vn{help} command works by parsing the file
\vn{\$TAO_DIR/doc/command-list.tex} which is the LaTeX file for the
Line Mode Commands chapter of the \tao manual. Thus, for the \vn{help}
command to work properly, the environmental variable \vn{TAO_DIR} must
be appropriately defined. Generally, \vn{TAO_DIR} will be defined if
the \bmad library setup scripts have been run.

%% history --------------------------------------------------------------
\section{history}\index{commands!history}
\label{s:history}

The \vn{history} command shows or reruns prior commands.  Format:
\begin{example}
  history           ! Print the command history.
  history <number>  ! Re-execute a command by number.
  history <string>  ! Re-execute last command that begins with <string>.
\end{example}

\vskip 0.2in
Every \tao command entered is recorded in a ``history stack'' and
these commands can be viewed and reinvoked as needed. 

Examples
\begin{example}
  history 34   ! Re-execute command number 34.
  history set  ! Re-execute last set command.  
\end{example}

%% misalign --------------------------------------------------------------
\section{misalign}\index{command!misalign}
\label{s:misalign}

The \vn{misalign} command misaligns a set of lattice elements. Format:
\begin{example}
   misalign <wrt> <ele_type> <range> <ele_attrib> <misalign_value>
\end{example}

\vskip 0.2in 

\vn{<ele_type>} is the type of element to misalign.  Only
elements of type \vn{<ele_type>} will be misaligned within the range.
If \vn{<ele_type>} begins with "*@" then choose all universes. If
\vn{<ele_type>} begin with "n@" then choose universe n. Otherwise the
viewed universe is used.

A lattice element will only be misaligned if its lattice index falls within
a range given by \vn{<range>}. \vn{<range>} is of the form
\vn{nnn:mmm} or the word \vn{ALL}. 

The element attribute \vn{<ele_attrib>} is ``misaligned'' by the rms
value \vn{<misalign_value>} with respect to the setting of
\vn{<wrt>}. Any element attribute can be misaligned provided the
attribute is free to vary.

If \vn{<misalign_value>} is prepended by 'x' then the misalignment value will be
a relative misalignment with respect to the \vn{<wrt>} value. Otherwise, it's an 
absolute rms value about the \vn{<wrt>} value.

In the special case where sbend strengths are misaligned then use
\vn{<ele_attrib> = g_err}. However, if a relative error is specified it will be 
relative to 'g'.

The possible values of \vn{<wrt>} are:
\begin{example}
  wrt_model          ! Misalign about the current model value
  wrt_design         ! Misalign about the design value
  wrt_survey         ! Misalign about the zero value
\end{example}

Examples
\begin{example}
   ! The following will misalign all quadrupole vertical positions in the viewed
   ! universe within the lattice element range 100:250 with respect to the zero 
   ! value by 300 microns
  misalign wrt_survey quadrupole 100:250 y_offset 300e-6
   ! The following will misalign all quadrupole strengths in all universes for
   ! the entire lattice with respect to the design value by 1%.
  misalign wrt_design *@quadrupole ALL k1 x0.01
\end{example}

%% output --------------------------------------------------------------
\section{output}\index{commands!output}
\label{s:output}

The \vn{output} command creates various files.
Format:
\begin{example}
  output bmad_lattice \{<file_name>\}       ! Write a Bmad lattice file of the model
  output beam \{-ascii\} -at <element_list> \{<file_name>\} 
                                          ! Write beam distribution data.
  output covariance_matrix \{file_name\}    ! Write the covariance and alpha matrices 
                                          !   from the Levenburg (lm) optimization.
  output curve <curve_name> \{<file_name>\} ! Write the curve data
  output derivative_matrix \{file_name\}    ! Write the \vn{dModel_Data/dVar} matrix.
  output digested \{<file_name>\}     ! Write a digested Bmad lattice file of the model.
  output gif \{<file_name>\}          ! create a gif file of the plot window.
  output hard                       ! Print the plot window to a printer.
  output hard-l                     ! Like "hard" except use landscape orientation. 
  output mad8_lattice \{<file_name>\} ! Write a MAD-8 lattice file of the model
  output madx_lattice \{<file_name>\} ! Write a MAD-X lattice file of the model
  output ps \{-scale <scale>\} \{<file_name>\}      
                                    ! Create a PS file of the plot window.
  output ps-l \{-scale <scale>\} \{<file_name>\}    
                                    ! Create a PS file with landscape orientation.
  output variable \{-good_var_only\} \{<file_name>\} 
                                    ! Create a Bmad file of variable values.
\end{example}

\vskip 0.2in 

If \vn{<file_name>} is not given then the defaults are:
\begin{example}
  Command                         Default File Name
  ------------------              ------------------
  output bmad_lattice             lat_#.bmad
  output beam                     beam_#.dat
  output curve                    curve
  output derivative_mat           derivative_matrix.dat              
  output digested                 digested8_lat_universe_#.bmad
  output gif                      tao.gif
  output mad8_lattice             lat_#.mad8
  output madx_lattice             lat_#.madx
  output ps                       tao.ps
  output variable                 global%var_out_file
\end{example}
where \vn{\#} is replaced by the universe number. \vn{output
curve} will produce two or three files: 
\begin{example}
  <file_name>.symbol_dat    ! Symbol coordinates file
  <file_name>.line_dat      ! Curve coords.
  <file_name>.particle_dat  ! Particle data file
\end{example}
The particle data file is only produced if particle
data is associated with the curve.
The curve coordinates are the the set of points that are used to draw the
(possibly smooth) curve through the symbols.

For \vn{ps} and \vn{ps-l}, the optional \vn{-scale} switch sets the
scale for the PostScript file. The default is 0 which autoscales to fit an
8-1/2 by 11 sheet of paper. A value of 1.0 will result in no scaling,
2.0 will double the size, etc.

The \vn{output variable} command has an optional \vn{-good_var_only}
switch.  If present, only the information on variables that are
currently used in the optimization is written.

\vn{output beam} will create a file of the particle positions when
beam tracking is being used. The \vn{-at} switch specifies at what
elements the particle positions are written. Element list format
(\sref{s:ele.list.format}), without any embedded blanks, is used for
the \vn{<element_list>} argument to the \vn{-at} switch. The
\vn{-ascii} switch is for writing text files. The default is to write
with a compressed binary format.  Note: Beam files can be used to
initialize \tao (\sref{s:command.line}). Example
\begin{example}
  output beam -at *   ! Output beam at every element.
\end{example}

Note: PGPLOT does a poor job producing gif files so consider
making a postscript file instead and using a ps to gif converter.

%% pause --------------------------------------------------------------
\section{pause}\index{commands!pause}
\label{s:pause}

The \vn{pause} command is used to pause \tao when executing a command
file (\sref{s:command.files}). Format:
\begin{example}
  pause \{<time>\} ! Pause time in seconds.
\end{example}
\vskip 0.2in

If \vn{<time>} is not present or zero, \tao will pause until the
\vn{CR} key is pressed. Once the \vn{CR} key is pressed, the command
file will be resumed. If \vn{<time>} is negative, \tao will suspend
the command file. Commands can now be issued from the keyboard and the
command file will be resumed when a \vn{continue} command
(\sref{s:continue}) is issued. Multiple command files can be
simultaneously suspended.  Thus, while one command file is suspended, a
second command file can be run and this command file too can be
suspended. A \vn{continue} command will resume the second command file
and when that command file ends, another \vn{continue} command will be
needed to complete the first suspended command file. Use the \vn{show
global} command to see the number of suspended command files.

Example:
\begin{example}
  pause 1.5    ! Pause for 1.5 seconds.
  pause -1     ! Suspend the command file until a \vn{continue} 
               !   command is issued.
\end{example}

%% place --------------------------------------------------------------
\section{place}\index{commands!place}
\label{s:place}

The \vn{place} command is used to associate a \vn{<template>} plot
with a \vn{<region>} and thus create a visible plot in that region. Format:
\begin{example}
  place <region> <template>
  place <region> none
  place * none
\end{example}

\vskip 0.2in 

To erase a plot from a region use \vn{none} in place of a template
name. Notice that by using multiple \vn{place} commands a
\vn{template} can be associated with more than one region.
\vn{place * none} will erase all plots.

Examples:
\begin{example}
  place top orbit  ! place the orbit template in the top region
  place top none   ! erase any plots in the top region
\end{example}

%% plot --------------------------------------------------------------
\section{plot}\index{commands!plot}
\label{s:plot}

The \vn{plot} command is used to determine what components are plotted
in the graphs of a given region. Format:
\begin{example}
  plot <region> <component>
\end{example}

\vskip 0.2in 

Use a ``-'' for baselines. 

Examples:
\begin{example}
  plot bottom model - design       ! Plot model - design in the bottom region
  plot top meas - model + design - ref 
\end{example}

%% quit --------------------------------------------------------------
\section{quit}\index{commands!quit}
\label{s:quit}

\vn{Quit} exits the program. Same as \vn{exit}.
Format:
\begin{example}
  quit
\end{example}

%% read --------------------------------------------------------------
\section{read}\index{commands!read}
\label{s:read}

The \vn{read} command is used to modify the currently
viewed \vn{model} lattice. Format:
\begin{example}
  read lattice <file_name>
\end{example}

\vskip 0.2in 
For example, with the appropriate file,
the \vn{read} command can be used to misalign the lattice
elements. The input file must be in Bmad standard lattice format.

%% restore --------------------------------------------------------------
\section{restore}\index{commands!restore}
\label{s:restore}

The \vn{restore} command cancels data or variable
vetoes. Format:
\begin{example}
  restore data  <data_name> <locations>
  restore var <var_name> <locations>
\end{example}

\vskip 0.2in 
See also the \vn{use}
and \vn{veto} commands.

Examples:
\begin{example}
  restore data orbit.x[23,34:56]   ! un-veto orbit.x 23 and 34 through 56.
  restore data orbit.x[23,34:56:2] ! un-veto orbit.x 23 and even datums between 34 
                                   !                                          and 56
  restore data *@orbit[34]         ! un-veto orbit data in all universes.
  restore var quad_k1[67]          ! un-veto variable
\end{example}

%% reinitialize -------------------------------------------------------
\section{reinitialize}\index{commands!reinitialize}
\label{s:reinit}

The \vn{reinitialize} command reinitializes various things. Format:
\begin{example}
  reinitialize beam
  reinitialize data
  reinitialize tao \{-init <tao_input_file>\} \{-beam_all <beam_file>\} 
     \{-beam0 <beam_file>\} \{-lat <lattice_file>\} \{-noplot\}
\end{example}

\vskip 0.2in 

The \vn{reinitialize beam} command reinitializes the beam at the start
of the lattice. That is, a new random distribution is generated. 
Note: This also reinitializes the model data.

\vn{reinitialize data} forces a recalculation of the model data.
Normally, a recalculation is done automatically when any lattice
parameter is changed so this command is generally only useful for
debugging purposes.

\vn{reinitializes tao} reinitializes \tao. This can be useful to reset
everything to initial conditions or to perform analysis with more than
one initialization file.  See section \sref{s:command.line} for
details on the arguments.  If an argument is not set, the
\vn{reinitialize} command uses the same argument value that were used in
the last \vn{reinitialize} command, or, if this is the first
reinitialization, what was used to start \tao. 

Examples:
\begin{example}
  reinit tao                         ! Reinit using previous arguments
  reinit tao -init tao_special.init  ! Reinitializes \tao with the initialization file 
                                     !   tao_special.init
\end{example}


%% run --------------------------------------------------------------
\section{run_optimizer}\index{commands!run}
\label{s:run}

The \vn{run_optimizer} command runs an optimizer. Format:
\begin{example}
  run_optimizer \{<optimizer>\}
\end{example}

\vskip 0.2in 

\index{de!optimizer}\index{lm!optimizer}
If \vn{<optimizer>} is not given then the default optimizer is
used. To stop the optimizer before it is finished press the period
``.''  key. If you want the optimizer to run forever run the optimizer
in \vn{single mode}. Valid optimizers are:
\begin{example}
  lm            ! Levenburg-Marquardt from Numerical Recipes 
  lmdif         ! Levenburg-Marquardt 
  de            ! Differential Evolution
\end{example}
See \sref{s:lattice.correction} for more details on the different
optimizers.

Examples:
\begin{example}
  run         ! Run the default optimizer
  run de      ! Run the de optimizer
\end{example}

%% scale --------------------------------------------------------------
\section{scale}\index{commands!scale}
\label{s:scale}

The \vn{scale} command scales the vertical axis of a graph or set of graphs.
Format:
\begin{example}
  scale \{-y\} \{-y2\} \{-gang\} \{-nogang\} \{<where>\} \{<value1> \}<value2>\}\}\}
\end{example}

Which graphs are scaled is determined by the \vn{<where>} switch. If
\vn{<where>} is not present or \vn{<where>} is \vn{all} then all
graphs are scaled. \vn{<where>} can be a plot name or the name of an
individual graph withing a plot.

\vskip 0.2in \vn{scale} adjusts the vertical scale of graphs. If
neither \vn{<value1>} nor \vn{<value2>} is present then an
\vn{autoscale} is performed and the scale is adjusted so that all the
data points are within the graph region. If an autoscale is performed
upon an entire plot, and if \vn{plot%autoscale_gang_y}
(\sref{s:template}) is True, then the chosen scales will be the same
for all graphs. That is, a single scale is calculated so that all the
data of all the graphs is within the plot region. The affect of
\vn{plot%autoscale_gang_y} can be overridden by using the \vn{-gang}
or \vn{-nogang} switches.

If only \vn{<value1>} is
present then the scale is taken to be from -\vn{<value1>} to
+\vn{<value1>}. If both are present than the scale is from
\vn{<value1>} to \vn{<value2>}.

A graph can have a \vn{y2} (left) axis scale that is separate from the
\vn{y} (right) axis. Normally, the \vn{scale} command will scale both
axes.  Scaling of just one of these axes can be achieved by using the
\vn{-y} or \vn{-y2} switches.

Examples:
\begin{example}
  scale top.x -3  7  ! Scale the x graph in the top region
  scale -y2 top.x    ! Scale only the y2 axis of the top.x graph.
  scale bottom       ! Autoscale the graphs of the plot in the bottom region
  scale              ! Scale everything
\end{example}


%% set --------------------------------------------------------------
\section{set}\index{commands!set}
\label{s:set}


The \vn{set} command is used to set values for datums,
variables, etc. Format:
\begin{example}
  set beam_init \{n@\}<component> = <value>
  set bmad_com <component> = <value>
  set csr_param <component> = <value>
  set curve <curve> <component> = <value>
  set data <data_name>|<component> = <value>
  set element <element_list> <attribute> = <value>
  set global <component> = <value>
  set graph <graph> <component> = <value>
  set lattice \{n@\}<destination\_lat> = <source\_lat>
  set opti_de_param <component> = <value>
  set plot <plot> <component> = <value>
  set plot_page <component> = <value1> \{<value2>\}
  set ran_state = <random_number_generator_state>
  set universe <what_universe> <on/off>
  set universe <what_universe> recalculate
  set universe <what_universe> mat6_recalc <on/off>
  set var <var_name>|<component> = <value>
  set wave <component> = <value>
\end{example}

\vskip 0.2in 
Note: For setting element attributes in the \vn{model}
lattice use the \vn{change} command.

To apply a set to all data or variable classes use ``*''
in place of \vn{<data_name>} or \vn{var_name}.

% Use the command:
%   help set <what>
% to obtain more information on a particular set subtopic. Example:
%   help set plot

%% set beam_init --------------------------------------------------------------

\begin{description}

\item[set beam\_init \{n@\}<component> = <value>] \Newline
For \vn{set beam_init}, the \vn{<component>}s that can be set can be
found in section~\sref{s:beam.init}. The optional \vn{n@} allows the
specification of the universe or universes the set is applied to. The
default is to set the viewed universe. Use the \vn{show beam} command
(\sref{s:show}) to see the current values of the \vn{beam_init}
structure.

Examples:
\begin{example}
  set beam_init 3@center(2) = 0.004  ! Set px center of beam for universe 3.
  set beam_init [1,2]@sig_e = 0.02   ! Set sig_e for universes 1 and 2.
\end{example}

%% set bmad_com --------------------------------------------------------------

\item[set bmad_com <component> = <value>] \Newline
For \vn{set bmad_com}: The \vn{show global} command will give a list of 
\vn{<component>}s.

Example:
\begin{example}
  set bmad_com radiation_fluctuations_on = T ! Turn on synchrotron radiation fluctuations.
\end{example}

%% set csr_param --------------------------------------------------------------

\item[set csr_param <component> = <value>] \Newline
Sets coherent synchrotron radiation parameters. Use the \vn{show
global -csr_param} command to see a list of \vn{<component>}s.

Example:
\begin{example}
  set csr_param n_bin = 30  ! Set number of bins used in the csr calc.
\end{example}

%% set curve --------------------------------------------------------------

\item[set curve <curve> <component> = <value>] \Newline
For \vn{set curve}, the \vn{<component>}s that can be set are:
\begin{example}
  ele_ref_name      = <string>  ! Name of reference element
  ix_ele_ref        = <number>  ! Index of reference element
  ix_universe       = <number>  ! Universe index.
  symbol_every      = <number>  ! Symbol skip number.
  draw_line         = <logical> 
  draw_symbols      = <logical> 
  draw_symbol_index = <logical> 
\end{example}
See Section~\sref{s:template} for a description of these components.
Use the \vn{show curve} (\sref{s:show}) to view the settings of the
components.

Examples:
\begin{example}
  set curve top.x.c1 ix_universe = 2  ! Set universe number for curve
\end{example}

%% set data --------------------------------------------------------------

\item[set data <data\_name>|<component> = <value>] \Newline
For \vn{set data}, the \vn{<component>}s that can be set are:
\begin{example}
  base        ! Base model value
  design      ! Design model value
  meas        ! Measured data value.
  ref         ! Reference data value.
  weight      ! Weight for the merit function.
  exists      ! Valid datum for computations?
  good_meas   ! A valid measurement has been taken?
  good_ref    ! A valid reference measurement has been taken?
  good_opt    ! Good for using in the merit function for optimization?
  good_plot   ! Good for using in a plot?
  good_user   ! This is what is set by the use, veto, and restore commands.
  merit_type  ! How merit contribution is calculated.
\end{example}
Besides a numeric value \vn{<value>} can be any of the above along with:
\begin{example}
  meas        ! Measured data value.
\end{example}

Examples:
\begin{example}
  set data *|ref = *|meas       ! Set ref data = measured in current universe.
  set data 2@orbit.x|base = 2@orbit.x|model 
                                ! Set the base orbit.x in universe 2 to model
\end{example}

%% set global --------------------------------------------------------------

\item[set element <element_list> <attribute> = <value>] \Newline
The \vn{set element} command sets the attributes of an element. Use the
\vn{show element} command to view the attributes of an element. 

\vn{<attribute>} and \vn{<value>} many


Although the \vn{set element} command can be used for setting real (as
opposed to logical or integer) attributes, the \vn{change element}
command will generally be better for setting these attributes.

Examples:
\begin{example}
  set ele *@rfcav::* is_on = F  ! Turns off all rfcavity elements in all universes.
  set ele q10w tracking_method = linear ! Set the tracking method
\end{example}

%% set global --------------------------------------------------------------

\item[set global <component> = <value>] \Newline
For \vn{set global}: The \vn{show global} command will give a list of 
\vn{<component>}s.

Example:
\begin{example}
  set global n_opti_loops = 30  ! Set number of optimization cycles
\end{example}

%% set graph --------------------------------------------------------------

\item[set graph <graph> <component> = <value>] \Newline
For \vn{set graph}, the \vn{component}s that can be set are:
\begin{example}
  component   = <string>
  clip        = <logical>
  ix_universe = <number>
  margin%x1   = <number>
  margin%x2   = <number>
  margin%y1   = <number>
  margin%y2   = <number>
\end{example}

Example:
\begin{example}
  set graph orbit.x component = model - design  
                          ! Plot model orbit - design orbit in the graph
\end{example}

%% set lattice --------------------------------------------------------------

\item[set lattice \{n@\}<destination\_lat> = <source\_lat>] \Newline
The \vn{set lattice} command transfers lattice parameters (element
strengths, etc., etc.) from one lattice (the \vn{source} lattice) to
another (the \vn{destination} lattice). Both lattices are restricted
to be from the same universe. The optional \vn{n@} prefix
(\sref{s:universe}) of the destination lattice can be used to specify
which universe the lattices are in. If multiple universes are
specified, the corresponding destination lattice will be set to the
corresponding source lattice in each universe. Note: At this time, it
is not permitted to transfer parameters between lattices in different
universes.

The destination lattices that can be set are:
\begin{example}
  model      ! Model lattice.
  base       ! Base lattice
\end{example}
The source lattice can be:
\begin{example}
  model       ! model lattice.
  base        ! base lattice.
  design      ! design lattice
\end{example}

Example:
\begin{example}
  set lattice *@model = design  ! Set the model lattice to the design in 
                                !   all universes.
  set lattice base = model      ! Set the base lattice to the model lattice in 
                                !   the currently viewed universe.
\end{example}

%% set opti_de_param --------------------------------------------------------------

\item[set opti_de_param <component> = <value>] \Newline
For \vn{set opti_de_param}: The \vn{show global} command will give a list of 
\vn{<component>}s.

Example:
\begin{example}
  set opti_de_param binomial_cross = T  ! Use binomial crossovers 
\end{example}

%% set plot --------------------------------------------------------------

\item[set plot <plot> <component> = <value>] \Newline
For \vn{set plot}, the \vn{component}s that can be set are:
\begin{example}
  autoscale_x = <logical>
  autoscale_y = <logical>
\end{example}

Example:
\begin{example}
  set plot orbit.x component = model - design  
                          ! Plot model orbit - design orbit in the graph
\end{example}

%% set plot_page --------------------------------------------------------------

\item[set plot\_page <component> = <value1> \{<value2>\}] \Newline
For \vn{set plot_page}, the \vn{<component>}s that can be set are:
\begin{example}
  title        = <string>          ! Set the plot title text
  subtitle     = <string>          ! Set the subtitle text
  subtitle_loc = <number> <number> ! Set the subtitle location (\%PAGE)
\end{example}
The \vn{subtitle_loc} component can be used to place the subtitle anywhere on
the plot page. This can be useful for referencing a noteworthy part of a graph
data.

Example:
\begin{example}
  set plot title = 'XYZ'  ! Set plot page title string
\end{example}

%% set ran_state --------------------------------------------------------------

\item[set ran\_state = <random_number_generator_state>] \Newline

Sets the state of the random number generator to a specific state. Use
\vn{show global -ran_state} to show the random number generator state.

%% set universe --------------------------------------------------------------

\item[\protect\parbox{6in}{
        set universe <what\_universe> <on/off> \\ 
        set universe <what\_universe> recalculate \\
        set universe <what\_universe> mat6\_recalc <on/off>}] \Newline
The \vn{set universe <what_universe> <on/off>} command will turn the
specified universe(s) on or off. Turning a universe off is useful to
speed up lattice calculations when this universe is not being
used. Or, if many changes are to be performed to a universe and there
is no need to do any lattice calculations between commands then
turning off all universes will speed things up. To specify the
currently viewed universe, you can use \vn{-1} as an index.  To
specify all universes, use \vn{*}.

If optimizing while one or more universes are turned off, the
variables associated with that universe will still be included in the
merit function but not the data for that universe. The variables will
still vary in the turned off universe.

The \vn{set universe <what_universe> recalculate} command will recalculate the
lattice parameters for that universe.

The \vn{set universe <what_universe> mat6_recalc} command will set whether
the 6x6 transfer matrices are calculated for a given universe. Turning
this off is useful in speeding up calculations in the case where the
transfer matrices are not being used (Warning: The transfer matrices
are needed to compute the Twiss parameters). Use the \vn{show
universe} command to see the state of the \vn{mat6_recalc_on} switch.

Example:
\begin{example}
  set universe 1 off
  set universe -1 on    ! Set on currently viewed universe.
  set universe * recalc ! Recalculate in all universes.
\end{example}

%% set var --------------------------------------------------------------

\item[set var <var\_name>|<component> = <value>] \Newline
For \vn{set var}, the \vn{<component>}s that can be set are:
\begin{example}
  model       ! Model lattice value.
  base        ! Base model value
  design      ! Design model value
  meas        ! Value at the time of a measurement.
  ref         ! Value at the time of a reference measurement.
  weight      ! Weight for the merit function.
  exists      ! Does this variable actually correspond to something?
  good_var    ! The optimizer can be allowed to vary it
  good_opt    ! Good for using in the merit function for optimization?
  good_plot   ! Good for using in a plot?
  good_user   ! This is what is set by the use, veto, and restore commands.
  step        ! Sets what a "small" variation of the variable is.
  merit_type  ! How merit contribution is calculated.
\end{example}

Example:
\begin{example}
  set var quad\_k1|weight = 0.1         ! Set quad\_k1 weights. 
\end{example}

%% set wave --------------------------------------------------------------

\item[set wave <component> = <value>] \Newline
The \vn{set wave} command sets the boundaries of the $A$ and $B$ regions 
for the wave analysis (\sref{c:wave}). The components are
\begin{example}
  ix_a = <ix_a1> <ix_a2>  ! A-region left and right boundaries.
  ix_b = <ix_b1> <ix_b2>  ! B-region left and right boundaries.
\end{example}
Example:
\begin{example}
  set wave ix_a = 15 27    ! Set A-region to span from datum #15 to #27
\end{example}

\end{description}

%% show --------------------------------------------------------------
\section{show}\index{commands!show}
\label{s:show}

The \vn{show} command is used to display information.
Format:
\begin{example}
  show \{-append <file_name>\} \{-noprint\} <what_to_show>
  show \{-write <file_name>\} \{-noprint\} <what_to_show>
\end{example}

\vn{<what_to_show>} may be one of:
\begin{example}
   alias
   beam \{<element_name_or_index>\}
   constraints
   curve \{-symbol\} \{-line\} <curve_name> 
   data \{<data_name>\} 
   derivative <data_name(s)> <var_name(s)>
   element \{-all_attributes\} \{-cross_section\} \{-data\} \{-no_slaves\} 
         \{-taylor\} \{-wig_terms\} <ele_name>
   global \{-bmad_com\} \{-csr_param\} \{-optimization\} \{-ran_state\} 
   graph <graph_name>
   hom
   key_bindings
   lattice \{-all_tracking\} \{-0undef\} \{-branch <branch>\} \{-custom <file_name>\} 
         \{-lords\} \{-middle\} \{-no_label_lines\} \{-blank_replacement <string>\} 
         \{-no_tail_lines\} \{-s <s1>:<s2>\} \{<elements>\}
   optimizer
   particle \{<bunch_index>.\}<particle_index> \{<element_index>\}
   particle -lost \{<bunch_index>\}
   plot
   plot \{<template_plot_name>\}
   plot \{<plot_region_name>\}
   plot -shapes
   top10 \{-derivative\}
   taylor_map \{-order <n_order>\} \{-s\} \{loc1 \{loc2\}\}
   universe \{universe_number\}
   universe -connections
   use
   value <expression>
   variable \{<var_name>\}
   variable <universe_number>@
   variable -bmad_format \{-good_opt_only\}
   wave
\end{example}

\vskip 0.2in The \vn{show} command has \vn{-append} and \vn{-write}
optional arguments which can be used to write the results to a file.
The \vn{show -append} command will appended to the output file. The
\vn{show -write} command will first erase the contents of the output
file. If \vn{global%write_file} has a \vn{*} character in it, a three
digit number is substituted for the \vn{*}. The value of the number
starts at \vn{001} and increases by 1 each time \vn{show -write} is
used.  Example:
\begin{example}
  show -write orb.dat orbit    ! Write orbit data to the file "orb.dat".
\end{example}

The \vn{-noprint} option suppresses printing and is useful when writing
large amounts of data to a file.

% Use the command:
%   help show <what>
% to obtain more information on a particular show subtopic. Example:
%   help show plot

%% show alias --------------------------------------------------------------

\begin{description}

\item[show alias] \Newline
Shows a list of defined aliases. See the \vn{alias} command for more
details.

%% show beam --------------------------------------------------------------

\item[show beam \{<element\_name\_or\_index>\}] \Newline

If \vn{<element_name_or_index>} is absent, \vn{show beam} shows
parameters used with beam tracking including the number of particles
in a bunch, etc.  If \vn{<element_name_or_index>} is present, \vn{show
beam} will show beam parameters at the selected element. Also see
\vn{show particle}.  Use the \vn{set beam_init} command to set values
of the \vn{beam_init} structure.

%% show constraints --------------------------------------------------------------

\item[show constraints] \Newline
Lists data and variable constraints.

%% show curve --------------------------------------------------------------

\item[show curve \{-symbol\} \{-line\} <curve\_name>] \Newline
Show information on a particular curve of a particular plot. See
\sref{s:plotting} for the syntax on plot, graph, and curve names.  Use
\vn{show plot} to get a list of plot names. The \vn{-symbol} switch
will additionally print the (x,y) points for the symbol placement and
the \vn{-line} switch will print the (x,y) points used to draw the
``smooth'' curve in between the symbols. The line or symbol points
from multiple curves can be printed by specifying multiple curves. Example:
\begin{example}
  show curve -sym orbit.*.*
\end{example}
This will produce a three column table assuming that the orbit plot
has curves \vn{orbit.x.c1} and \vn{orbit.y.c1}. When specifying
multiple curves, each curve must have the same number of data points
and it will be assumed that the horizontal data values are the same
for all curves so the horizontal data values will be put in column 1.

Example:
\begin{example}
  show curve r2.g1.c3     ! Show the attributes of a curve named "c3" which is 
                          !   in the graph "g1" which is plotted in region "r2".
\end{example}

%% show data --------------------------------------------------------------

\item[show data \{<data\_name>\}] \Newline
Shows data information. If \vn{<data_name>} is not
present then a list of all \vn{d2_data} names is printed.

Examples:
\begin{example}
  show data                   ! Lists d2_data for the currently viewed universe.
  show data -1@               ! Same as "show data"
  show data *@                ! Shows all d2_data in all universes.
  show data orbit             ! Show orbit data.
  show data orbit.x           ! list all orbit.x data elements.
  show data orbit.x[35]       ! Show details for orbit.x element 35
  show data orbit.x[35,86:95] ! list orbit.x elements 35 and 86 through 95
  show data orbit.x[1:99:5]   ! list every fifth orbit.x between 1 and 99  
\end{example}

%% show derivative --------------------------------------------------------------

\item[show derivative <data\_name(s)> <var\_name(s)>] \Newline
\index{lm}\index{svd}
Shows the derivative dModel\_Value/dVariable. This derivative is used
by the optimizers \vn{lm} and \vn{svd}. Note: Wild card characters can
be used to show multiple derivatives.

Example:
\begin{example}
  show deriv orbit.x[23] k1[34] ! Show dModel_Value/dVariable Derivative.
  show deriv * *                ! Show all derivatives. Warning! The output 
                                ! may be large.
\end{example}

%% show element --------------------------------------------------------------

\item[show element \{-all\_attributes\} \{-cross_section\} \{-data\} \{-no_slaves\} 
                     \{-taylor\} \{-wig\_terms\} <ele\_name>] \Newline
This shows information on lattice elements. The syntax for \vn{<ele_name>} 
is explained in section \sref{s:ele.list.format}. If
\vn{<ele_name>} contains a wild card or a class name then a list of
elements that match the name are shown. If no wild--card or class name
is present then information about the element whose name matches
\vn{<ele_name>} is shown. If \vn{<ele_name>} is a number $n$, then the $n$\Th
element in the lattice list will be shown.

If the \vn{-all_attributes} switch is present, then all of the element attributes
will be displayed. The default is is to display only those attributes
with non-zero values. ``Attributes'' here does not include the cross-section,
Taylor map and wiggler element parameters.

If the \vn{-cross_section} switch is present, the cross-section
information for a \vn{capillary} element is displayed.

If the \vn{-data} switch is present, then information about the 
all the datums associated with the element will be listed. 

When using wild cards in the element name, if the \vn{-no_slaves}
switch is present, \vn{super_slave} and \vn{multipass} slave elements will not be listed.

If the \vn{-taylor} switch is present then the Taylor map associated
with an element, if there is one, is also displayed.  Similarly, if the
\vn{-wig_terms} switch is present, then any associated wiggler terms for
a \vn{map_type} \vn{wiggler} element is printed.

Example:
\begin{example}
  show ele quad::z* -no_slaves  ! list all non-slave quadrupole elements with 
                                !   names beginning with "z".
  show ele q10w                 ! Show a particular lattice element.
  show ele -all_att 105         ! Show element #105 in the lattice.
\end{example}

%% show global --------------------------------------------------------------

\item[show global \{-bmad_com\} \{-csr_param\} \{-optimization\} \{-ran_state\} ] \Newline
The \vn{show global} command, used without any optional switches,
shows information on the global parameter structure
(\sref{s:globals}). The optional switches are
  \begin{description}
  \item[-bmad_com] \Newline
Displays \vn{bmad_com} components (\sref{s:globals}).
  \item[-csr_param] \Newline
Displays \vn{csr_param} components (\sref{s:globals}).
  \item[-optimization] \Newline
Displays optimization parameters.
  \item[-ran_state] \Newline
Displays the state of the random number generator. Use this with the
\vn{set ran_state} command.
  \end{description}

%% show graph --------------------------------------------------------------

\item[show graph <graph\_name>] \Newline
Show information on a particular graph of a particular plot. See
\sref{s:plotting} for the syntax on plot, graph, and curve names.
Use \vn{show plot} to get a list of plot names.

Example:
\begin{example}
  show curve r2.g1         ! Show the attributes of graph "g1" which is 
                           !   plotted in region "r2".
\end{example}

%% show hom --------------------------------------------------------------

\item[show hom] \Newline
Shows long--range higher order mode information for linac accelerating
cavities.

%% show key_bindings  --------------------------------------------------------------

\item[show key\_bindings] \Newline
Shows all key bindings.

%% show lattice --------------------------------------------------------------

\item[\protect\parbox{6in}{
  show lattice \{-all\_tracking\} \{-0undef\} \{-branch <branch>\} \{-custom <file\_name>\} \\
  \hspace*{0.35in} \{-lords\} \{-middle\} \{-no\_label\_lines\} \{-blank_replacement <string>\} \\
  \hspace*{0.35in} \{-no\_tail\_lines\} \{-s <s1>:<s2>\} \{<elements>\}  }] \Newline
Shows Twiss and orbit data, etc. for the \vn{model} lattice at the specified
element locations. The default is to show the parameters at the exit
end of the elements. To show the parameters in the middle use the
\vn{-middle} switch.

If present, the \vn{-no_label_lines} switch will prevent the printing
of the header (containing the column labels) lines at the top and
bottom of the table.  This is useful when the output needs to be read
in by another program. The \vn{-no_tail_lines} just suppress the header
lines at the bottom of the table.

If present, the \vn{-lords} switch will print a list of lord elements only.

The \vn{-branch} can be used to specify the branch of the lattice.
The default is the main branch (\# 0).

The locations to show can either be specified using the \vn{-elements}
switch, or by specifying a longitudinal position range with \vn{-s},
or (the default) by specifying a range of element indices.  The syntax
used for specifying which elements to show when the 
\vn{-elements} switch is used is given in section~\sref{s:ele.list.format}. 
For example:
\begin{example}
  show lat -ele marker:bpm*   !
\end{example}
This will show the parameters at all marker elements whose name begin
with \vn{"bpm"}. 

Alternatively, a range of elements can be specified using the element
index, name, or the element's longitudinal position with a \vn{":"} being
used to separate the index. For example
\begin{example}  
  show lat  45:76, 101, 106    ! Show element #45 through #76 and 101 and 106.
  show lat q34w:q45e           ! Show from element q34w through q45e.
  show lat -s  23.9:55.3       ! Show elements whose position is between 
                               !   23.9 meters and 55.3 meters.
\end{example}
The \vn{-all_tracking} switch can be used to show all the elements
in the tracking part of the lattice. The
\vn{element_list} is optional but if it is present it must be at the
end of the command line.

If neither \vn{-elements}, \vn{-all}, nor a range is given, the first
200 elements are shown.

To customize the output use the command \vn{show lattice -custom
<file_name>}. A customization file looks like:
\begin{example}
  &custom_show_list
    column(1) = "#",                     "i6",     6 
    column(2) = "x",                     "x"       1       ! blank space
    column(3) = "ele::#[name]",          "a",      0
    column(4) = "ele::#[key]",           "a16",   16
    column(5) = "ele::#[s]",             "f10.3", 10
    column(6) = "ele::#[beta_a]",        "f7.2",   7
    column(7) = "1e3 * ele::#[orbit_x]", "f8.3",   8, "Orbit_x| (mm)" 
  /
\end{example}
each \vn{column(1)} has four components. The first component is what
is to be displayed in that column. Algebraic expressions are permitted
(\sref{s:arithmetic}). Note: Use of \vn{ele::} and \vn{beam::}, etc
sources is accepted but these constructs cannot be evaluated at the
center of an element. That is the \vn{-middle} switch will have no
effect on such constructs.

To encode the element index, use a \vn{\#}.
Any element attribute is permitted ("show ele" will show element
attributes or see the Bmad manual). Additionally, the following are
recognized:
\begin{example}
  x                          ! Add spaces
  #                          ! Index number of element.
  ele::#[name]                ! Name of element.
  ele::#[key]                 ! Type of element (``quadrupole'', etc.)
  ele::#[slave_status]        ! Slave type (``super_slave'', etc.)
  ele::#[lord_status]         ! Slave type (``multipass_lord'', etc.)
  ele::#[type]                ! Element type string (see \bmad manual).
\end{example}
If an attribute does not exist for a given element (for example,
\vn{quadrupole}s do not have a \vn{voltage}), a series of dashes,
``----'', will be placed in the appropriate spot in the table.
Additionally, an arithmetic expression that results in a divide by
zero will result in dashes being printed. This behavior is changed if
the \vn{-0undef} switch is present. In this case, a zero, ``0'', will
be printed. 

Additionally, The \vn{-blank_replacement <string>} switch specifies
that whenever a blank string is encountered (for example, the
\vn{type} attribute for an element can be blank), \vn{<string>} should
be substituted in its place. \vn{<string>} may not contain any blank
characters. Example:
\begin{example}
  show lat -cust custom.file -blank -- 1:100
\end{example}
This will replace any blank fields with ``--''.

Note: Data can be used in custom output but data is always evaluated at
the exit end of an element even when the \vn{-middle} switch is used.

The second component is the Fortran edit descriptor. The third column
is the total width of the field. Notice that strings (like the element
name) are left justified and numbers are right justified. In the case
of a number followed by a string, there will be no white space in
between. The use of an "x" column can solve this problem. A field
width of 0, which can only be used for an \vn{ele::\#[name]} column,
indicates that the field width will be taken to be one greater then
the maximum characters of any element name.

The last component is column title name. This component is optional
and if not present then \tao will choose something appropriate. The
column title can be split into two lines using \vn{"|"} as a separator.
In the example above, The column title corresponding to \vn{"Orbit_x| (mm)"} 
is:
\begin{example}
  show lattice 50:100         ! Show lattice elements with index 50 through 100
\end{example}

%% show optimizer --------------------------------------------------------------

\item[show optimizer] \Newline
Shows information pertinent to optimization: Data and variables used, etc.

%% show opt_vars --------------------------------------------------------------

\item[show opt\_vars] \Newline
Shows the settings of the variables used in the optimization using the 
Bmad standard lattice input format.

%% show particle --------------------------------------------------------------

\item[\protect\parbox{6in}{
        show particle \{<bunch\_index>.\}<particle\_index> \{<element\_name\_or\_index>\} \\
        show particle -lost \{bunch\_index\} }] \Newline
The command \vn{show particle \{<bunch_index>.\}<particle_index>}
shows information on a particle at a given element. The default for
the optional \vn{\{bunch_index\}} index is set by the global variable
\vn{global%bunch_to_plot}. The default \vn{<element_name_or_index>} is 0 (the
starting position).  Also see \vn{show beam}.

\vn{show particle -lost} shows which particles are lost during beam
tracking. The default for the optional \vn{\{bunch_index\}} index is
set by \vn{global%bunch_to_plot}. Note: Using the \vn{-lost} option
results in one line printed for each lost particle. It is thus meant
for use with bunches with a small number of particles.

Examples:
\begin{example}
  show part 3.47 8   ! Shows information on particle #47 of bunch #3 at 
                     !   lattice element #8.
  show part 47 8     ! Same as above except the default bunch is used.
  show part -lost 3  ! Show lost particle positions for bunch #3
\end{example}

%% show plot --------------------------------------------------------------

\item[\protect\parbox{6in}{ 
        show plot \\
        show plot \{<template\_plot\_name>\} \\
        show plot \{<plot\_region\_name>\} \\
        show plot -shapes}] \Newline

A simple \vn{show plot} displays which templates are being plotted and
in which regions and also all available templates. See
\sref{s:plotting} for the syntax on plot, graph, and curve names. A
\vn{show plot <plot_name>} will display information on a particular
plot. 

If the \vn{-shapes} switch is present, the shapes used in drawing 
\vn{floor_plan} or \vn{lat_layout} plots are printed.

%% show top10 --------------------------------------------------------------

\item[show top10 \{-derivative\}] \Newline
If the \vn{-derivative} switch is present, this command shows top
dMerit/dVariable derivatives, and Largest changes in variable value.
If not present, this command
shows top contributors to the merit function.

Note: To set the number of top contributors shown, use the command
\vn{set global n_top10 = nnn} where \vn{nnn} is the desired number to
be shown.

%% show taylor_map --------------------------------------------------------------

\item[show taylor\_map \{-order <n\_order>\} \{-s\} \{loc1 \{loc2\}\}] \Newline
Shows the Taylor transfer map for the \vn{model} lattice of the
currently \vn{view}ed universe from the exit end of the element given
by \vn{loc1} to the exit end of the element given by \vn{loc2} where
\vn{loc1} and \vn{loc2} are element names or indexes. The exception is
that if \vn{loc1} is present but \vn{loc2} is not then the map is from
the beginning of the lattice to the exit end of \vn{loc2}. If neither
\vn{loc1} nor \vn{loc2} are present, the transfer map is computed for
the entire lattice. If the \vn{-s} switch is present, \vn{loc1}
and \vn{loc2} will be interpreted as longitudinal s-positions.

The \vn{-order} switch, if present, gives the limiting order to
display. In any case, the maximum order of the map is limited to the
order set by the lattice file.

Examples:
\begin{example}
  show taylor -order 1 q10e q10w  ! 0th and 1st order maps from q10e to q10w
  show taylor 45                  ! Transfer map from the beginning to #45
  show taylor -s 13.4  23.6       ! Transfer map from s = 13.4 meters to 23.6 meters. 
\end{example} 

%% show universe --------------------------------------------------------------

\item[\protect\parbox{6in}{ 
        show universe \{universe\_number\} \\
        show universe -connections}] \Newline
If the \vn{-connections} switch is present, show information on the
connections between various universes. Otherwise, shows various
parameters associated with a given universe. If no universe is
specified then the current viewed universe is used. Parameters
displayed include tune, chromaticity, radiation integrals, etc.

%% show use --------------------------------------------------------------

\item[show use] \Newline

Shows what data and variables are used in a format that, if saved to a file, can
be read in with a \vn{call} command.

%% show value --------------------------------------------------------------

\item[show value <expression>] \Newline

Shows the value of an expression. Examples:
\begin{example}
  show value sqrt(3@lat:orbit.x[34]|model) + sin(0.35)
\end{example}


%% show variable --------------------------------------------------------------

\item[\protect\parbox{6in}{
        show variable \{<var\_name> <locations>\} \\
        show variable <universe\_number>@  \\
        show variable -bmad\_format \{-good\_opt\_only\} }] \Newline
Shows variable information. If \vn{<var_name>} is not
present,  a list of all \vn{v1_var} classes is printed. To show variables
associated with the \vn{n}th universe use the syntax \vn{show var n@}.

If the \vn{-bmad_format} switch is used then the Bmad lattice parameters that
the \tao variables control will be printed in Bmad lattice
format. This is the same syntax used in generating the variable files
when an optimizer is run. If \vn{-good_opt_only} is used in conjunction with
\vn{-bmad_format} then the list of variables will be restricted to ones that
are currently being used in the optimization.

Examples:
\begin{example}
  show var             ! List all variables.
  show var quad_k1     ! List variables in the quad_k1[*] array.
  show var quad_k1[10] ! List detailed information on the variable quad_k1[10].
  show var 2@          ! List all variables that control attributes in universe 2.
  show var -bmad       ! List variables in Bmad Lattice format.
\end{example}

%% show variable --------------------------------------------------------------

\item[show wave]
The \vn{show wave} command shows the results of the current wave 
analysis (\sref{c:wave}).

\end{description}

%% single-mode --------------------------------------------------------------
\section{single-mode}\index{commands!single-mode}
\label{s:sing}

The \vn{sing-mode} command puts \tao into \vn{single mode} (\sref{c:single}).
Format:
\begin{example}
  single-mode
\end{example}

%% spawn --------------------------------------------------------------
\section{spawn}\index{commands!spawn}
\label{s:spawn}

The \vn{spawn} command is used to pass a command to the command shell. Format:
\begin{example}
  spawn <shell_command>
\end{example}

\vskip 0.2in

The users default shell is used. \vn{spawn} only works in Linux and
Unix environments.

Examples:
\begin{example}
  spawn gv quick_plot.ps &      ! view a postscript file with ghostview
                                ! (and return to the TAO prompt)
  spawn tcsh                    ! launch a new tcsh shell 
                                ! (type 'exit' to return to TAO)
\end{example}

%% use --------------------------------------------------------------
\section{use}\index{commands!use}
\label{s:use}

The \vn{use} command un-vetoes data or variables and sets a veto for
the rest of the data. Format:
\begin{example}
  use data  <data_name>
  use var <var_name>
\end{example}

\vskip 0.2in 

See also the \vn{restore} and \vn{veto} commands.

Examples:
\begin{example}
  use data orbit.x             ! use orbit.x data in the viewed universe.
  use data *@orbit[34]         ! use element 34 orbit data in all universes.
  use var quad_k1[67]          ! use variable.
  use var quad_k1[30:60:10]    ! use variables 30, 40, 50 and 60.
  use data *                   ! use all data in the viewed universe.
  use data *@*                 ! use all data in all universes.
\end{example}


%% veto --------------------------------------------------------------
\section{veto}\index{commands!veto}
\label{s:veto}

The \vn{veto} command vetoes data or variables. Format:
\begin{example}
  veto data <data_name> <locations>
  veto var <var_name> <locations>
\end{example}

\vskip 0.1in 

See also the \vn{restore} and \vn{use} commands.

Examples:
\begin{example}
  veto data orbit.x[23,34:56]  ! veto orbit.x data.
  veto data *@orbit.*[34]      ! veto orbit data in all universes.
  veto var quad_k1[67]         ! veto variable
  veto var quad_k1[30:60:10]   ! veto variables 30, 40, 50 and 60
  veto data *                  ! veto all data
  veto data *[10:20]           ! veto all data from index 10 to 20 (see note)
\end{example}

Note: The command `\cmd{veto data *.*[10:20]}' will veto all d1\_data elements
within the range 10:20 \textit{using the index convention for each d1\_data
structure separately}. This may produce curious results if the
indexes for the d1\_data structures do not all point to the same lattice
elements. 

%% view --------------------------------------------------------------
\section{view}\index{commands!view}
\label{s:view}

The \vn{view} command changes which universe data is taken from for
plotting. Format:
\begin{example}
  view <number>
\end{example}

\vskip 0.1in 

This also sets the default universe that commands are applied to in
the absence of a universe prefix (\sref{s:universe}).

Examples:
\begin{example}
  view 2   ! Make universe #2 the default.
\end{example}

%% wave --------------------------------------------------------------
\section{wave}\index{commands!wave}
\label{s:wave}

The \vn{wave} command sets what data is to be used for the wave
analysis (\sref{c:wave}). Format:
\begin{example}
  wave <curve> \{<plot_location>\}
\end{example}
\vskip 0.1in

The \vn{<curve>} argument specifies what plot curve is to be used in
the analysis. The specified curve must be visible in the plot window.
The \vn{<plot_location>} argument specifies the plot region where the
results of the wave analysis is to be plotted. If not present, the
region defaults to the region of the plot containing the curve used
for the analysis.

Examples:
\begin{example}
  wave orbit.x      ! Use the orbit.x curve for the wave analysis.
  wave top.x bottom ! Use the curve in top.x and the results of the 
                    !  wave analysis are put in the bottom region.
\end{example}

%% x-axis --------------------------------------------------------------
\section{x-axis}\index{commands!x-axis}
\label{s:x.axis}

The \vn{x-axis} command sets the data type used for the x-axis coordinate.
Format:
\begin{example}
  x-axis <where> <axis_type>
\end{example}

\vskip 0.1in 
The \vn{x-axis} command sets the \vn{plot%x_axis_type}. This determines 
what data is used for the horizontal axis. Possibilities
for \vn{<axis_type>} are:
\begin{example}
  index     -- Use data index
  ele_index -- Use data element index
  s         -- Use longitudinal position.
\end{example}
Note that \vn{index} only makes sense for data that has an index
associated with it.

Examples:
\begin{example}
  x-axis * s
  x-axis top index
\end{example}

%% x-scale --------------------------------------------------------------
\section{x-scale}\index{commands!x-scale}
\label{s:x.scale}

The \vn{x-scale} command scales the horizontal axis of a graph or set of graphs.
Format:
\begin{example}
  x-scale \{-gang\} \{-nogang\} \{<where>\} \{<value1> \}<value2>\}\}\}
\end{example}

Which graphs are scaled is determined by the \vn{<where>} switch. If
\vn{<where>} is not present or \vn{<where>} is \vn{*} then all
graphs are scaled. \vn{<where>} can be a plot name or the name of an
individual graph withing a plot.  If \vn{<where>} is \vn{s} then the
scaling is done only for the plots where the x--axis scale is the
longitudinal s-position.

\vskip 0.2in \vn{x-scale} sets the lower and upper bounds for the
horizontal axis.  If both \vn{<bound1>} and \vn{<bound2>} are present
then \vn{<bound1>} is taken to be the lower (left) bound and
\vn{<bound2>} is the upper (right) bound. If only \vn{<bound1>} is
present then the bounds will be from -\vn{<bound1>} to \vn{<bound1>}.
If neither is present then an \vn{autoscale} will be invoked to give
the largest bounds commensurate with the data. If an autoscale is
performed upon an entire plot, and if \vn{plot%autoscale_gang_x}
(\sref{s:template}) is True, then the chosen scales will be the same
for all graphs. That is, a single scale is calculated so that all the
data of all the graphs is within the plot region. The affect of
\vn{plot%autoscale_gang_x} can be overridden by using the \vn{-gang}
or \vn{-nogang} switches.

Note: The \vn{x-scale} command will vary the number of major divisions
(set by plot%x%major_divisions (\sref{s:template})) to try to give a
nice looking axis. The result can be that if two plots have the same
range of data but differing major division settings, the \vn{x-scale}
command can produce differing results.

Example:
\begin{example}
  x-scale                 ! Autoscale all x-axes.
  x-scale * 0 100         ! Scale all x-axes to go from 0 to 100.
\end{example}

%% xy-scale --------------------------------------------------------------
\section{xy-scale}\index{commands!xy-scale}
\label{s:xy.scale}

The \vn{xy-scale} command sets horizontal and vertical axis bounds. Format:
\begin{example}
  xy-scale \{<where>\} \{<value1> \}<value2>\}\}\}
\end{example}

\vn{xy-scale} is equivalent to an \vn{x-scale} followed by a \vn{y-scale}.

Which graphs are scaled is determined by the \vn{<where>} switch. If
\vn{<where>} is not present or \vn{<where>} is \vn{*} then all
graphs are scaled. \vn{<where>} can be a plot name or the name of an
individual graph withing a plot. 

\vskip 0.2in \vn{xy-scale} sets the lower and upper bounds for both
the horizontal and vertical axes.  This is just a shortcut for doing
an \vn{x-scale} followed by a \vn{scale}.  If both \vn{<bound1>} and
\vn{<bound2>} are present then \vn{<bound1>} is taken to be the lower
(left) bound and \vn{<bound2>} is the upper (right) bound. If only
\vn{<bound1>} is present then the bounds will be from -\vn{<bound1>}
to \vn{<bound1>}. 

If neither \{<bound1>\} nor \{<bound2>\} is present then an
\vn{autoscale} will be invoked to give the largest bounds commensurate
with the data.

Example:
\begin{example}
  xy-scale          ! Autoscale all axes.
  xy-scale * -1 1   ! Scale all axes to go from -1 to 1.
\end{example}

