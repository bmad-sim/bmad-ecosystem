// File generated by: write_lattice_in_mad_format;
// Bmad Lattice File: /nfs/acc/user/dcs16/bmad-ecosystem/regression_tests/write_foreign_test/write_foreign_test.bmad;

beam_def: Beam, Particle = Positron, Energy = 1E-3, Npart = 1E10;;

AB_MULTIPOLE1: multipole, knl = {0, 0, 250.171}, ksl = {0, 0, -131.963};
A_KICKER_1: kicker, l = 0, hkick = 5E-3;
AC_KICKER1: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = 3.0375E-8, rm66 = 1;
A_KICKER_2: kicker, l = 0, vkick = 5E-3;
AC_KICKER2: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = 1.9869E-5, rm66 = 1;
A_KICKER_3: kicker, l = 0, vkick = 5E-3;
AC_KICKER3: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = 7.04361E-7, rm66 = 1;
BEAMBEAM1: beambeam, sigx = 3E-3, sigy = 3E-4, xma = 3E-3, yma = 3E-3, charge = -1;
CRAB_CAVITY1: drift, l = 0.2;
E_KICKER_4: kicker, l = 0, hkick = 5E-3, vkick = 1E-3;
ECOLLIMATOR1: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = 1.93052E-5,
     rm66 = 1;
E_KICKER_5: kicker, l = 0, hkick = 2.5E-3;
ELSEPARATOR1: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = 1.40626E-5,
     rm66 = 1;
E_KICKER_6: kicker, l = 0, vkick = 2.5E-3;
ELSEPARATOR2: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = 1.40626E-5,
     rm66 = 1;
EM_FIELD1: drift, l = 1.4;
EM_FIELD2: drift, l = 1.4;
FIDUCIAL1: drift, l = 0;
FLOOR_SHIFT1: drift, l = 0;
GKICKER1: drift, l = 0;
HKICKER1: hkicker, l = 4.5, kick = 5E-3, tilt = 0.1;
INSTRUMENT1: drift, l = 4.5;
KMULTIPOLE_7: multipole, knl = {2.98501E-6}, ksl = {2.995E-7};
KICKER1: kicker, l = 4.5, vkick = 3E-3, tilt = 0.1;
MATCH1: matrix;
MONITOR1: drift, l = 4.5;
MULTIPOLE1: multipole, knl = {0, 0, 0, -3.28036}, ksl = {0, 1, 0, -3.08046};
OCTUPOLE1: octupole, l = 4.5, k3 = 1000, tilt = 0.392699;
DRIFT_PATCH1: drift, l = 4E-3;
PATCH1__t: translation, dx = 1E-3, dy = 2E-3;
PATCH1__y: yrotation, angle = -1E-3;
PATCH1__x: xrotation, angle = -2E-3;
PATCH1__s: srotation, angle = 2;
QMULTIPOLE_8: multipole, knl = {2.12132E-3, 0.03}, ksl = {-2.12132E-3, 0};
Q_KICKER_9: kicker, l = 0, vkick = -5E-5;
QUADRUPOLE1: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = 7.47961E-5, rm66 = 1;
QMULTIPOLE_10: multipole, knl = {-2.12132E-3, -0.03}, ksl = {2.12132E-3, 0};
Q_KICKER_11: kicker, l = 0, vkick = -5E-5;
QUADRUPOLE2: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = 8.70229E-5, rm66 = 1;
QMULTIPOLE_12: multipole, knl = {2.12132E-23, 3E-22}, ksl = {-2.12132E-23, 0};
Q_KICKER_13: kicker, l = 0, vkick = -5E-5;
QUADRUPOLE3: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = -9.57925E-6,
     rm66 = 1;
QMULTIPOLE_14: multipole, knl = {2.12132E-3, 0.03}, ksl = {-2.12132E-3, 0};
Q_KICKER_15: kicker, l = 0, vkick = -5E-5;
QUADRUPOLE4: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = 7.53958E-5, rm66 = 1;
QMULTIPOLE_16: multipole, knl = {-2.12132E-3, -0.03}, ksl = {2.12132E-3, 0};
Q_KICKER_17: kicker, l = 0, vkick = -5E-5;
QUADRUPOLE5: matrix, rm11 = 1, rm22 = 1, rm33 = 1, rm44 = 1, rm55 = 1, kick5 = 8.76901E-5, rm66 = 1;
RCOLLIMATOR1: collimator, l = 4.5, apertype = rectangle, aperture = {0.2, 0.1};
RFCAVITY1: rfcavity, l = 4.5, volt = 0.1, lag = 0.6, harmon = 184;
RFCAVITY2: rfcavity, l = 4.5, volt = 0.1, lag = 0.6, harmon = 184;
RFCAVITY3: rfcavity, l = 0, volt = 0.1, lag = 0.6, harmon = 184;
SBEND1: sbend, l = 0.6, k1 = 0.3, tilt = 0.1, k0 = 1.66389E-5, k0s = -1.65834E-4;
RBEND2: sbend, l = 0.6, tilt = 0.1, k0 = 1.66389E-5, k0s = -1.65834E-4;
SBEND3: sbend, l = 0.6, k1 = 0.3, tilt = 0.1, k0 = 1.66389E-5, k0s = -1.65834E-4;
SMULTIPOLE_18: multipole, knl = {2.99501E-8, 2.98004E-7}, ksl = {-2.98502E-7, -1.4701E-6};
RBEND4: sbend, l = 0.600001, angle = 6.00001E-3, e1 = 0.103, e2 = 0.203, tilt = 0.1,
     k0 = -0.0197834, k0s = -1.65834E-4;
SMULTIPOLE_19: multipole, knl = {2.995E-6, 2.98004E-5}, ksl = {-2.98501E-5, -1.4701E-4};
SBEND5: sbend, l = 0.6, angle = 6E-3, e1 = 0.1, e2 = 0.2, tilt = 0.1, fint = 0.7,
     fintx = 0.7, hgap = 2, k0 = 1.66389E-5, k0s = -1.65834E-4;
SMULTIPOLE_20: multipole, knl = {2.99501E-11, 2.98004E-10}, ksl = {-2.98502E-10, -1.4701E-9};
RBEND6: sbend, l = 0.600001, angle = 6.00001E-3, e1 = 0.103, e2 = 0.203, tilt = 0.1,
     k0 = -0.0199832, k0s = -1.65834E-4;
SMULTIPOLE_21: multipole, knl = {2.995E-6, 2.98004E-5}, ksl = {-2.98501E-5, -1.4701E-4};
SBEND7: sbend, l = 0.6, angle = 6E-3, e1 = 0.1, e2 = 0.2, tilt = 0.1, k0 = 1.66389E-5,
     k0s = -1.65834E-4;
SEXTUPOLE1: sextupole, l = 0.6, k2 = 1, tilt = 0.523599;
SOLENOID1: solenoid, l = 2.6, ks = 1;
SOLENOID2: solenoid, l = 2.6, ks = 1E-12;
DRIFT_Z22: drift, l = 1.3;
SOL_QUAD1: matrix;
DRIFT_Z23: drift, l = 1.3;
SOL_QUAD2: matrix;
TMULTIPOLE_24: multipole, knl = {0, 0, 0.29552, 55.2637}, ksl = {0, 0, -0.955336, 23.3651};
THICK_MULTIPOLE1: drift, l = 4.5;
TAYLOR1: matrix, l = 0.5, rm11 = 1.00445, kick1 = -9.54885E-3, rm12 = 8.81211, rm13 = 3.15887E-6,
     rm14 = 6.24736E-7, rm15 = -7.9443E-4, rm16 = -1.59897E-3, tm111 = -0.186887,
     tm114 = -4.49986E-8, tm124 = 2.26515E-6, tm134 = 0.0737887, tm144 = 7.48496E-3,
     tm155 = 8.26014E-4, tm116 = -2.8822E-3, tm126 = -5.81233, tm136 = -2.26589E-6,
     tm146 = -1.07353E-6, tm156 = -2.59775E-5, tm166 = 1.59915E-3, rm22 = 1.0001,
     kick2 = 2.75022E-4, rm21 = 5.17076E-4, rm23 = 3.66717E-7, rm24 = 7.25623E-8,
     tm222 = -8.24667E-4, tm233 = 0.0216962, tm214 = -1.66887E-8, tm224 = -1.00551E-7,
     tm234 = 8.56569E-3, tm244 = 8.76072E-4, tm215 = 1.53868E-6, tm225 = 2.97087E-3,
     tm246 = -7.74636E-8, tm256 = -8.16983E-7, tm266 = 2.88699E-8, rm33 = 1, kick3 = 3.26106E-5,
     rm35 = -8.48787E-6, rm36 = -1.62965E-5, tm312 = 5.23063E-8, tm322 = 9.9263E-7,
     tm313 = 0.373775, tm323 = 0.0737792, tm314 = 0.0737176, tm324 = 0.0145516, tm335 =
     -1.40995E-3, tm345 = -3.0176, tm355 = 8.41554E-6, tm316 = -2.26546E-6, tm326 = -1.07041E-6,
     tm336 = 2.88268E-3, tm346 = -5.80943, tm356 = 1.19481E-7, rm44 = 0.999897, rm43 = -5.17211E-4,
     rm45 = 8.33163E-9, tm422 = -7.37549E-8, tm434 = -1.64887E-8, tm444 = -1.74264E-7,
     tm435 = -1.53357E-6, tm445 = 2.97026E-3, tm416 = -2.40618E-8, tm426 = -7.70389E-8,
     tm436 = -2.31499E-6, tm446 = 1.02381E-4, rm55 = 1, kick5 = -8.6214E-5, rm51 = -7.97679E-7,
     rm52 = -1.59888E-3, rm53 = 7.57432E-9, tm533 = -3.42794E-5, tm514 = -2.19303E-6,
     tm524 = -8.12886E-7, tm534 = 2.88908E-3, tm544 = -2.90487, tm515 = 8.04598E-7,
     tm525 = -2.36194E-5, tm545 = 1.45261E-7, tm556 = 1.45043E-8, tm566 = -7.41367E-7,
     rm66 = 1, kick6 = -7.57023E-6, rm61 = 1.22662E-6, rm62 = 7.92211E-4, rm63 = 4.24341E-9,
     rm64 = 8.46364E-6, rm65 = 5.94094E-3, tm613 = 3.69542E-7, tm623 = 1.17658E-6,
     tm633 = 1.60572E-5, tm614 = 1.1766E-6, tm624 = 4.78291E-7, tm634 = 1.42032E-3,
     tm644 = 1.50447, tm615 = -5.30024E-7, tm626 = 3.29521E-5, tm646 = -4.68311E-8;
VKICKER1: vkicker, l = 4.5, kick = 5E-3, tilt = 0.1;
LCAVITY1: lcavity, l = 4.5, deltae = 5E-3, freq = 500, phi0 = 0.15;
LCAVITY2: lcavity, l = 4.5, deltae = 5E-6, freq = 500, phi0 = 0.15;
LCAVITY3: lcavity, l = 4.5, deltae = 5E-3, freq = 500, phi0 = 0.15;
END: marker;

//---------------------------------;

line_1: line = (AB_MULTIPOLE1, A_KICKER_1, AC_KICKER1, A_KICKER_1, A_KICKER_2,
   AC_KICKER2, A_KICKER_2, A_KICKER_3, AC_KICKER3, A_KICKER_3, BEAMBEAM1,
   CRAB_CAVITY1, E_KICKER_4, ECOLLIMATOR1, E_KICKER_4, E_KICKER_5,
   ELSEPARATOR1, E_KICKER_5, E_KICKER_6, ELSEPARATOR2, E_KICKER_6, EM_FIELD1,
   EM_FIELD2, FIDUCIAL1, FLOOR_SHIFT1, GKICKER1, HKICKER1, INSTRUMENT1,
   KMULTIPOLE_7, KICKER1, KMULTIPOLE_7, MATCH1, MONITOR1, MULTIPOLE1,
   OCTUPOLE1, DRIFT_PATCH1, PATCH1__T, PATCH1__Y, PATCH1__X, PATCH1__S,
   QMULTIPOLE_8, Q_KICKER_9, QUADRUPOLE1, Q_KICKER_9, QMULTIPOLE_8,
   QMULTIPOLE_10, Q_KICKER_11, QUADRUPOLE2, Q_KICKER_11, QMULTIPOLE_10,
   QMULTIPOLE_12, Q_KICKER_13, QUADRUPOLE3, Q_KICKER_13, QMULTIPOLE_12,
   QMULTIPOLE_14, Q_KICKER_15, QUADRUPOLE4, Q_KICKER_15, QMULTIPOLE_14,
   QMULTIPOLE_16, Q_KICKER_17, QUADRUPOLE5, Q_KICKER_17, QMULTIPOLE_16,
   RCOLLIMATOR1, RFCAVITY1, RFCAVITY2, RFCAVITY3, SAD_MULT1, SAD_MULT2,
   SBEND1, RBEND2, SBEND3, SMULTIPOLE_18, RBEND4, SMULTIPOLE_18,
   SMULTIPOLE_19, SBEND5, SMULTIPOLE_19, SMULTIPOLE_20, RBEND6, SMULTIPOLE_20,
   SMULTIPOLE_21, SBEND7, SMULTIPOLE_21, SEXTUPOLE1, SOLENOID1, SOLENOID2,
   DRIFT_Z22, SOL_QUAD1, DRIFT_Z22, DRIFT_Z23, SOL_QUAD2, DRIFT_Z23,
   TMULTIPOLE_24, THICK_MULTIPOLE1, TMULTIPOLE_24, TAYLOR1, VKICKER1,
   LCAVITY1, LCAVITY2, LCAVITY3, END);

//---------------------------------;

lat: line = (line_1);
use, period = lat;

//---------------------------------;

select, flag = error, clear;
select, flag = error, range = AB_MULTIPOLE1[1];
ealign, dx = 0.02;
select, flag = error, clear;
select, flag = error, range = BEAMBEAM1[1];
ealign, dphi = -0.05, dx = 3E-3, dy = 3E-3;
select, flag = error, clear;
select, flag = error, range = ECOLLIMATOR1[1];
ealign, dphi = -1E-3, dx = 0.02, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = ELSEPARATOR1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = ELSEPARATOR2[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = FLOOR_SHIFT1[1];
ealign, dtheta = 0.01, dphi = -0.02, dx = 0.1, dy = 0.2, ds = 0.3;
select, flag = error, clear;
select, flag = error, range = GKICKER1[1];
ealign, dtheta = 0.02, dphi = -0.03, dx = 0.04, dy = 0.05, ds = 0.06;
select, flag = error, clear;
select, flag = error, range = HKICKER1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = KICKER1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = MULTIPOLE1[1];
ealign, dx = 0.05;
select, flag = error, clear;
select, flag = error, range = OCTUPOLE1[1];
ealign, dphi = -1E-3, dx = 0.01, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = DRIFT_PATCH1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2E-6;
select, flag = error, clear;
select, flag = error, range = PATCH1[1];
ealign, dtheta = 1E-3, dphi = -2E-3, dx = 9.97998E-4, dy = 1.996E-3;
select, flag = error, clear;
select, flag = error, range = QUADRUPOLE1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = QUADRUPOLE2[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = QUADRUPOLE3[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = QUADRUPOLE4[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = QUADRUPOLE5[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = RCOLLIMATOR1[1];
ealign, dphi = -1E-3, dx = 0.02, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = RFCAVITY1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = RFCAVITY2[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = RFCAVITY3[1];
ealign, dphi = -1E-3, dx = 0.05;
select, flag = error, clear;
select, flag = error, range = SBEND1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = RBEND2[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = SBEND3[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = RBEND4[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = SBEND5[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = RBEND6[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = SBEND7[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = SEXTUPOLE1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -3E-4;
select, flag = error, clear;
select, flag = error, range = SOLENOID1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -1.3E-3;
select, flag = error, clear;
select, flag = error, range = SOLENOID2[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -1.3E-3;
select, flag = error, clear;
select, flag = error, range = SOL_QUAD1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -1.3E-3;
select, flag = error, clear;
select, flag = error, range = DRIFT_Z22[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -6.5E-4;
select, flag = error, clear;
select, flag = error, range = DRIFT_Z22[2];
ealign, dphi = -1E-3, dx = 0.05, dy = -6.5E-4;
select, flag = error, clear;
select, flag = error, range = SOL_QUAD2[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -1.3E-3;
select, flag = error, clear;
select, flag = error, range = DRIFT_Z23[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -6.5E-4;
select, flag = error, clear;
select, flag = error, range = DRIFT_Z23[2];
ealign, dphi = -1E-3, dx = 0.05, dy = -6.5E-4;
select, flag = error, clear;
select, flag = error, range = THICK_MULTIPOLE1[1];
ealign, dx = 0.02;
select, flag = error, clear;
select, flag = error, range = VKICKER1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = LCAVITY1[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = LCAVITY2[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2.25E-3;
select, flag = error, clear;
select, flag = error, range = LCAVITY3[1];
ealign, dphi = -1E-3, dx = 0.05, dy = -2.25E-3;

//---------------------------------;

initial: beta0, betx = 10, bety = 10, alfx = 0, alfy = 0, 
     dx = 0, dpx = 0, dy = 0, dpy = 0, 
     x = 1E-3, px = 2E-3, y = 3E-3, py = 4E-3, t = 4.29791E-3, pt = 6.98014E-3
     ;
twiss, beta0 = initial;
